generator client {
  provider               = "prisma-client"
  output                 = "./prisma-generated-types"
  moduleFormat           = "cjs"
  generatedFileExtension = "ts"
  importFileExtension    = ""
}

datasource db {
  provider     = "mysql"
  relationMode = "foreignKeys"
}

enum FieldType {
  TEXT
  TEXTAREA
  CHECKBOX
  RADIO
  SINGLE_UPLOAD
  MULTI_UPLOAD
  SINGLE_SELECT
  MULTI_SELECT
}

enum FieldComparator {
  EQUALS
  GREATER_THAN
  GREATER_OR_EQUALS_THAN
  LESS_THAN
  LESS_OR_EQUALS_THAN
}

model Field {
  id             String          @id @default(uuid())
  tenantId       String          @map("tenant_id")
  organizationId String          @map("organization_id")
  context        String
  key            String
  label          String
  type           FieldType
  comparator     FieldComparator
  required       Boolean         @default(false)

  minLength Int?    @map("min_length")
  maxLength Int?    @map("max_length")
  pattern   String?

  placeholder String?
  group       String
  order       Int     @default(0)

  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  options FieldOption[]
  values  FieldValue[]

  @@unique([tenantId, organizationId, context, key])
  @@index([tenantId, organizationId, group, context, active])
  @@map("fields")
}

model FieldOption {
  id        String   @id @default(uuid())
  fieldId   String   @map("field_id")
  value     String
  label     String
  order     Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  field Field @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@unique([fieldId, value])
  @@index([fieldId, active])
  @@map("field_options")
}

model FieldValue {
  id        String   @id @default(uuid())
  fieldId   String   @map("field_id")
  entityId  String
  value     String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  field Field @relation(fields: [fieldId], references: [id], onDelete: Cascade)

  @@unique([fieldId, entityId, value])
  @@index([fieldId, entityId])
  @@map("field_values")
}
